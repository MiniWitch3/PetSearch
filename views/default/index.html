{{extend 'layout.html'}}


<div class="User">
    {{if auth.user_id is None:}}
        {{=A('Sign Up', _class='btn btn-danger', _href=URL('default', 'user', args=['register']))}}
		{{=A('Sign In', _class='btn btn-success', _style='margin-left: 10px', _href=URL('default', 'user', args=['login']))}}
	{{else:}}
        {{=A('New Pet', _class='btn btn-success', _href=URL('default', 'addpet'))}}
    {{pass}}
</div>

<div id="target"></div>



<script id="template" type="text/ractive">

<div class="search">
<div id="new_msg">
<select>
  <option value="Cat">Cat</option>
  <option value="Dog">Dog</option>
</select>
<select>
  <option value="Male">Male</option>
  <option value="Female">Female</option>
</select>
<div class="line_check"><input type="checkbox" unchecked="{% house_trained %}"/>House Trained</div>
<div class="line_check"><input type="checkbox" unchecked="{% kid_friendly %}"/>Kid Friendly</div>
<div class="line_check"><input type="checkbox" unchecked="{% pet_friendly %}"/>Pet Friendly</div>
<div class="line_check"><input type="checkbox" unchecked="{% outdoor_pet %}"/>Outdoor Pet</div>
<div class="line_check"><input type="checkbox" unchecked="{% indoor_pet %}"/>Indoor Pet</div>
<div class="line_check"><input type="checkbox" unchecked="{% frequent_exercise %}"/>Frequent Exercise </div>
<div class="line_check"><input type="checkbox" unchecked="{% young_pet %}"/>Young Pet</div>
<div class="line_check"><input type="checkbox" unchecked="{% older_pet %}"/>Older Pet</div>
<input class="btn btn-primary" type="submit" value="Submit" on-click="search"/>
</div>
</div>

{% #if search_done == true %}
 {% #pet_dict:pet_id %}
       <div class="petsearch">
       <h2 class="pet_name">{% name %}</h2>
       <div class="pet_image">{% pet_image %}</div>
       <div class="date_posted">{% posted %}</div>
       </div>
 {% /pet_dict %}
{% /if %}


{% #if loading %}
  <div id="load_spinner">
    <i class="fa fa-spinner fa-pulse fa-4x"></i>
  </div>
{% /if %}

</script>

<script>
$(function() {
  // Ractive object
  var MAIN = new Ractive({
    el: '#target',
    template: '#template',
    delimiters: ['{%', '%}'],
    tripleDelimiters: ['{%%', '%%}'],
    data: {
      pet_dict: {},
      pet_id: "{{=pet_id}}",
      list_o_pets: "",
      loading: true,
      search_done: false
    },
  });

  // http://stackoverflow.com/questions/105034/create-guid-uuid-in-javascript
  function generateUUID(){
    var d = new Date().getTime();
    if(window.performance && typeof window.performance.now === "function"){
        d += performance.now();; //use high-precision timer if available
    }
    var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
        var r = (d + Math.random()*16)%16 | 0;
        d = Math.floor(d/16);
        return (c=='x' ? r : (r&0x3|0x8)).toString(16);
    });
    return uuid;
  }

MAIN.on('search', function(e) {
     $.ajax({
       url: "{{=URL('default', 'get_pets')}}",
              data: {
                Cat_or_Dog: (MAIN.get('Cat_or_Dog')),
                gender: (MAIN.get('gender')),
                house_trained: (MAIN.get('house_trained')),
                kid_friendly: (MAIN.get('kid_friendly')),
                pet_friendly: (MAIN.get('pet_friendly')),
                outdoor_pet: (MAIN.get('outdoor_pet')),
                indoor_pet: (MAIN.get('indoor_pet')),
                frequent_exercise: (MAIN.get('frequent_exercise')),
                young_pet: (MAIN.get('young_pet')),
                older_pet: (MAIN.get('older_pet'))
              },
       method: "POST",
       success: function(data) {
         MAIN.set('loading', false);
         MAIN.set('search_done', true);
         MAIN.set('pet_dict', data['pet_dict']);
       },
       fail: function() {
         $("#server_error").show();
       }
     });
});
});
</script>